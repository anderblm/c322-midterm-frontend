<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create a Quiz</title>
<link rel="stylesheet" href="navbar.css">
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="make-a-quiz.css">
<link rel="stylesheet" href="cards.css"> <!-- Added cards.css for card styling -->
</head>
<body>
<ul class="topnav">
  <li><a class="active" href="index.html">Home</a></li>
  <li><a href="add-question.html">Add questions</a></li>
  <li><a href="make-a-quiz.html">Create a quiz</a></li>
  <li><a href="take-a-quiz.html">Take a quiz</a></li>
  <li class="right"><a href="#about">About</a></li>
</ul>

<div class="container">
  <h2>Create a Quiz</h2>
  <form id="quizForm">
    <label for="quizTitle">Quiz Title:</label><br>
    <input type="text" id="quizTitle" name="quizTitle" required><br><br>

    <!-- Questions Bank with .questions class -->
    <div class="questions">
      <label for="questionsBank">Questions Bank:</label><br>
      <select id="questionsBank" name="questionsBank" multiple size="5" required>
        <!-- Options will be dynamically added here -->
      </select><br><br>

      <!-- Cards will be displayed here -->
      <div id="list" class="cards"></div> <!-- This is where the cards will be displayed -->

    </div>

    <button type="button" onclick="addQuestionToQuiz()">Add Question to Quiz</button><br><br>

    <!-- Selected Questions with .quiz class -->
    <div id="selectedQuestionsContainer" class="quiz">
      <label for="selectedQuestions">Selected Questions:</label><br>
      <select id="selectedQuestions" name="selectedQuestions" multiple size="5" required>
        <!-- Selected questions will appear here -->
      </select><br><br>
    </div>

    <button type="button" onclick="saveQuizChanges()">Save your changes</button>
    <button type="button" onclick="saveAndStartNew()">Save this quiz and start a new one</button>
  </form>
</div>

<script src="script.js"></script>
<script>
  let host = "http://localhost:8080";
  let questions = [];

  displayTheQuestions();

  async function getAll() {
    let response = await fetch(host + "/questions");
    let result = await response.json();
    return result;
  }

  async function displayTheQuestions() {
    if (questions.length == 0) {
      questions = await getAll();
    }

    let list = document.getElementById("list");
    list.innerHTML = "";

    for (let question of questions) {
      let div = document.createElement("div");
      div.className = "card";
      div.setAttribute("onclick", `selectQuestion(${question.id})`); // Add onclick event to select question
      let innerHtml = `
     
    <img src="http://localhost:8080/questions/${question.id}/image" alt="question" style="width:100%">
    <div class="container">
      <h4><b>${question.id}</b></h4> 
      <p>${question.description}</p>
      <form>
          <input type="radio" id="q${question.id}ptionA" name="q2Answer" value="A">
          <label for="q${question.id}ptionA">${question.choices[0]}</label><br>

          <input type="radio" id="q${question.id}ptionB" name="q2Answer" value="B">
          <label for="q${question.id}ptionB">${question.choices[1]}</label><br>

          <input type="radio" id="q${question.id}ptionC" name="q2Answer" value="C">
          <label for="q${question.id}ptionC">${question.choices[2]}</label><br>       
      </form> 
    </div>
 
        `;
      div.innerHTML = innerHtml;
      list.appendChild(div);
    }
  }

  function selectQuestion(questionId) {
    let selectedQuestion = questions.find(question => question.id === questionId);
    updateSelectedQuestionsList(selectedQuestion); // Update the selected questions list with the entire question
  }

  function updateSelectedQuestionsList(selectedQuestion) {
    let selectedQuestionsList = document.getElementById("selectedQuestions");
    let option = document.createElement("option");
    option.value = selectedQuestion.id;
    option.text = selectedQuestion.description; // Display question description
    selectedQuestionsList.appendChild(option);
  }

  async function saveQuizChanges() {
    let quizTitle = document.getElementById("quizTitle").value;
    let selectedQuestionsList = document.getElementById("selectedQuestions").options;
    let selectedQuestionObjects = [];

    for (let option of selectedQuestionsList) {
      let selectedQuestion = questions.find(question => question.id === parseInt(option.value));
      selectedQuestionObjects.push(selectedQuestion);
    }

    let requestBody = {
      quizTitle: quizTitle,
      questions: selectedQuestionObjects // Send entire question objects
    };

    try {
      let response = await fetch(host + "/quizzes", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(requestBody)
      });

      console.log("Response status:", response.status);
      console.log("Response body:", await response.text()); // Log response body for debugging

      if (response.status === 200) {
        alert("Quiz saved successfully!");
      } else {
        throw new Error("Error saving the quiz.");
      }
    } catch (error) {
      console.error(error);
      alert("An error occurred while saving the quiz.");
    }
  }
</script>
</body>
</html>
